## send-fio

Пакет скриптов для запуска (в ручном или автоматическом режиме) FIO тестов для оценки производительности I/O дисковой подсистемы.

Возможности:

 - тестирование индивидуального RAW диска (не должен содержать данные);
 - тестирование файловой системы;
 - вывод результатов и/или отправка/публикация данных на сервис perf.SpaceVM;

## Usage

Общий запуск осуществляется скриптом 'run', который связывает два других скрипта (которые также можно вызвать отдельно):

 'run-fio'  - генерация профиля теста для FIO, запуск 'fio'. В результате работы в текущем каталоге будет создана директория tests/XXX с результатами и логами fio
 'send-fio' - запаковка результатов tests/XXXX в архив и отправка на сервис perf.SpaceVM;

При запуске скрипта 'run' сканируются доступные локальные диски. Если найден хотябы один локальные чистый (без данных) диск, он становится доступным
для тестирования напрямую, что позволяет получить номинальные физические I/O характеристики. В случае, если имеются локальные диски содержащие какие-либо данные,
с целью защиты уничтожения ценных данных скрипт по-умолчанию не позволяет выбрать эти диски для тестирования. Если вы уверены, что диски с данными можно
использовать для проведения тестирований (и потерять данные, которые расположены на этих дисках), можно использовать переменную окружения DESTROY_DISK_DATA=1, например:

```
env DESTROY_DISK_DATA=1 ./run
```

для использования диска для тестирования.

Если 'чистых' дисков нет и не использована переменная окружения DESTROY_DISK_DATA=1, скрипт предполагает проведение тестов на уже имеющихся смонтированных файловых системах,
по-умолчанию это каталог '/tmp'. В случае запуска пакета на SpaceVM кластере, скрипт автоматически просканирует имеющиеся datapool и будет предполагать тестирование
каждого из датапулов (но можно выбрать индивидуально).

Другие рабочие переменные окружения:

FIO_AUTO_PROFILE   - задавать название профиля для авто-теста, например: 'randread'. Может принимать значение 'all', что означает последовательный запуск всех возможных тестов.
                     По-умолчанию значение параметра не задано, что соответствует профилю 'manual' - интерактивный режим для выбора тестов в ручном режиме.


FIO_AUTO_RWMIXREAD - задать значение по-умолчанию параметра 'rwmixread', используемого в mixed тестах (с read/write нагрузкой). По-умолчанию - '50';


FIO_AUTO_BS        - задать значение по-умолчанию параметра 'bs', по-умолчанию: '4k';

PERF_SPACEVM_SEND  - если установлен в '0' - не выполнять скрипт 'send-fio' и тем самым не высылать результаты на сервис perf.SpaceVM. По-умолчанию PERF_SPACEVM_SEND=1 - слать;

FIO_OFFLINE_MODE   - если установлен в '1' - не пробовать получать список профилей с checkin сервера;


Чтобы протестировать конкретный mountpoint:

```
spacevm-perf-fio-run /mnt/tmp
```
